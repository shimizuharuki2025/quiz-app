<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#0056b3">
    <link rel="apple-touch-icon" href="/quiz-app/lawson_logo.png">
    <script>
        // Service Worker の登録
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('Service Worker registered', reg))
                    .catch(err => console.error('Service Worker registration failed', err));
            });
        }

        // 認証状態確認して適切な画面にリダイレクト
        (async function () {
            try {
                // ゲストモードパラメータをチェック
                const urlParams = new URLSearchParams(window.location.search);
                const isGuestMode = urlParams.get('guest') === 'true';

                if (isGuestMode) {
                    // ゲストモードの場合、そのままクイズアプリへ
                    window.location.href = 'quiz-app/index.html?guest=true';
                    return;
                }

                // ログイン状態を確認
                const response = await fetch('/api/auth/me', {
                    credentials: 'include'
                });

                const data = await response.json();

                if (data.loggedIn) {
                    // ログイン中の場合、クイズアプリへ
                    window.location.href = 'quiz-app/index.html';
                } else {
                    // 未ログインの場合、ログイン画面へ
                    window.location.href = 'auth/login.html';
                }
            } catch (error) {
                console.error('認証確認エラー:', error);
                // エラーの場合はログイン画面へ
                window.location.href = 'auth/login.html';
            }
        })();
    </script>
</head>

<body>
    <div style="display: flex; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif;">
        <p>読み込み中...</p>
    </div>
</body>

</html>